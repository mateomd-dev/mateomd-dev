{"generatedAt":1672674744795,"generateTime":184,"contents":[{"_path":"/articles/how-i-built-a-real-self-driving-car-from-scratch","_dir":"articles","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"How I Built a Real Self-Driving Car from Scratch","description":"After my second year of university in the summer of 2022, I decided to work on one of the most advanced\nprojects up to that time - developing an autopilot software from scratch and implementing it in a\nreal car. After making some of the main parts of my code public and publishing a demo video, I\nreceived many questions about the project. Therefore, I decided to share the story behind the\ndevelopment process.","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After my second year of university in the summer of 2022, I decided to work on one of the most advanced\nprojects up to that time - developing an autopilot software from scratch and implementing it in a\nreal car. After making some of the main parts of my "},{"type":"element","tag":"a","props":{"href":"https://github.com/mateomd-dev/maeve-autopilot","rel":["nofollow"]},"children":[{"type":"text","value":"code"}]},{"type":"text","value":" public and publishing a "},{"type":"element","tag":"a","props":{"href":"https://youtu.be/h1Wg7Cn1D-E","rel":["nofollow"]},"children":[{"type":"text","value":"demo video"}]},{"type":"text","value":", I\nreceived many questions about the project. Therefore, I decided to share the story behind the\ndevelopment process."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I have always been fascinated by anything related to AI and Machine\nLearning. The idea of computers being able to learn and a complete paradigm shift in\nsoftware development, was incredibly inspiring to me. However, I could not wrap my head around it\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"at all"}]},{"type":"text","value":". Around February 2021, I started with arguably the most popular Coursera courses on the\nrelated topics — "},{"type":"element","tag":"a","props":{"href":"https://www.coursera.org/learn/machine-learning?utm_source=gg&utm_medium=sem&utm_campaign=07-StanfordML-ROW&utm_content=07-StanfordML-ROW&campaignid=2070742271&adgroupid=80109820241&device=c&keyword=machine%20learning%20mooc&matchtype=b&network=g&devicemodel=&adpostion=&creativeid=516962315003&hide_mobile_promo&gclid=CjwKCAiAksyNBhAPEiwAlDBeLHvf3K9Jfjs77yy7pFjfqGtLrzN0UMYYtcw3WhhsBxfEMC1IsaQuahoCqmEQAvD_BwE","rel":["nofollow"]},"children":[{"type":"text","value":"Machine\nLearning"}]},{"type":"text","value":",\nthe "},{"type":"element","tag":"a","props":{"href":"https://www.coursera.org/specializations/deep-learning?utm_source=gg&utm_medium=sem&utm_campaign=17-DeepLearning-ROW&utm_content=17-DeepLearning-ROW&campaignid=6465471773&adgroupid=77656689495&device=c&keyword=coursera%20deep%20learning%20specialization&matchtype=b&network=g&devicemodel=&adpostion=&creativeid=506750650449&hide_mobile_promo&gclid=CjwKCAiAksyNBhAPEiwAlDBeLPUYNmgNJuRtZNZUMIzj0njAzstXWVMLouSp1283hz5N_FCnUUr4kRoCGmUQAvD_BwE","rel":["nofollow"]},"children":[{"type":"text","value":"Deep Learning\nSpecialization"}]},{"type":"text","value":"\nand a part of the "},{"type":"element","tag":"a","props":{"href":"https://www.coursera.org/professional-certificates/tensorflow-in-practice","rel":["nofollow"]},"children":[{"type":"text","value":"TensorFlow Professional\nCertificate"}]},{"type":"text","value":". "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nI'm a huge proponent of hands-on learning, so I wanted to pick a project in a domain of interest I\ncould apply my knowledge. As a big fan of Tesla, I was drawn into the world of Autonomous Vehicles\nand Computer Vision right from the start - however, I wanted to go beyond just implementing a neural\nnetwork in e.g., a GTA car, so I took this idea to the next level."}]},{"type":"element","tag":"h1","props":{"id":"development-process"},"children":[{"type":"text","value":"Development Process"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After preliminary research, I \"settled\" for an autonomous steering\nmechanism due to time and budget constraints. It became apparent very quickly that even steering\nalone is a very challenging task. I started with the arguably more traditional approach of explicit decomposition of the problem by looking\ninto various algorithms for tasks such as lane detection and path planning. However, as this project was meant to\ndeepen my still-somewhat-shallow knowledge of Deep Learning, I was inclining more towards end-to-end\napproaches using neural networks. Soon, I came across an "},{"type":"element","tag":"a","props":{"href":"https://images.nvidia.com/content/tegra/automotive/images/2016/solutions/pdf/end-to-end-dl-using-px.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"NVIDIA paper"}]},{"type":"text","value":" from 2016, which discusses an implementation of a CNN that maps raw pixels from the video input to the steering\ncommands with surprisingly good results. There are also quite a few implementations available, which inspired me to create my own. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nThe high-level overview of the system is quite straightforward:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Mount a camera system to the front of the car"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Get the steering angle value at any given time"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Pair these two up and pass them through the neural network"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Build a system to execute a steering command on the steering wheel"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Adapt the system to a real-time execution, i.e., take an image of the road ahead, predict the\nsteering angle and execute it on the steering unit"}]}]},{"type":"element","tag":"h2","props":{"id":"choosing-the-car"},"children":[{"type":"text","value":"Choosing the Car"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Given the highly experimental and potentially destructive\nnature of this project, I bought the cheapest car I could find - concretely, the first model of\nSkoda Fabia. At this stage, I did not have a detailed plan for the implementation, so my only\nrequirement for the car was power steering, which made it possible to build the steering mechanism\nwithout extensive and costly adjustments to the steering column."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Naturally, the first and most important thing I did was to print a Tesla logo and slap it on the\nfront of the car. One time, I almost drove away with the wrong car..."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"test alt","class":"w-100 mt-3 mb-5","src":"/img/maeve-two-cars.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"collecting-data-on-a-budget"},"children":[{"type":"text","value":"Collecting Data on a Budget"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To stick to the \"end-to-end\" aspect of this project, I wanted to\nproduce my own dataset. After experimenting with a bunch of web cameras, I mounted an old iPhone 6S\nbehind the front window and used that instead for the video input. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nMeasuring the steering angle was a bigger challenge. Modern cars typically have either the CAN bus\nthat can be tapped into to get the precise steering angle at any given time, or a separate\nsteering angle sensor built directly inside the steering wheel. My car had neither, so I had to\nbuild my own sensor from scratch."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The main idea behind my design was to use the dynamically changing resistance caused by the steering\nand map it to the steering angle value. The first issue I faced was that the steering wheel\nturns more than 360 degrees, so I needed to account for these \"extra turns.\" My initial solution was\nto use a coil around the steering column, and a brush mounted to the column that would be sliding\nacross the coil, changing the resistance of the wire. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nSimpler (and, for most people, more obvious...) solution I ended up with was based on gears and a\npotentiometer: I calculated the gear ratios to map the steering angle values to the 360° range of a\npotentiometer mounted underneath the steering column, printed the gears, and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"voilà"}]},{"type":"text","value":":"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Steering Angle Sensor","class":"w-100 mt-3 mb-5","src":"/img/maeve-gears.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The potentiometer is wired up to an Arduino board, which then goes to the laptop running the code\nfor reading and matching the steering angle with the video input from the iPhone. While the script\nitself wasn't too complex, the difficult aspect of this setup was synchronizing the serial\ncommunication between the Arduino and the laptop due to the somewhat strict latency requirements of\nthe driving task. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nAfter that, long hours of driving around my town with Lex Fridman's podcasts in the background became\nmy go-to leisure activity."}]},{"type":"element","tag":"h3","props":{"id":"data-pre-processing"},"children":[{"type":"text","value":"Data Pre-Processing"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I experimented with several techniques during the training process of\ndifferent models, but only some produced significant results. The images from the video\ninput are resized to 100x100 and cropped to remove unnecessary features that confused the network,\nespecially during bad lighting conditions (mainly the sky getting overexposed). All images are\nconverted to a single-channel colour. Apart from these methods, I tried applying low values of\nGaussian blur and other filters - this made a small difference in some situations, but I was\nnot able to fully analyse the correlation."}]},{"type":"element","tag":"h2","props":{"id":"the-neural-network-architecture"},"children":[{"type":"text","value":"The Neural Network Architecture"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With a decent dataset, it was time to design\nand train the neural network. As I have mentioned, the initial architecture was based on the NVIDIA\npaper, however, I have experimented with many models and adjustments, especially in the demo, where\nthe overall system was very different."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The main architecture described in the paper, which is also part of the public repository, is the\nfollowing:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A Normalization Layer"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Six Convolution Layers (with ReLU activations), each followed by a Max-Pooling Layer"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A Flatten Layer"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Four Fully-Connected Layers, followed by one neuron in the last layer for the angle prediction"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Neural Network Architecture Diagram","class":"w-100 mt-3 mb-5","src":"/img/maeve-neural-net.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The network minimizes the MSE between the output of the network and the actual\nsteering angle. I wrote the model in TensorFlow, and for most parts, I was using my old laptop to\ntrain it (yes, it took ages to iterate). I used the Adam optimizer and Dropout during the training to obtain better results on\nother datasets. This model was sufficient for a slow drive on the testing dataset, failing only on complex or\nnon-repeating scenarios. As expected, the network's activations mainly highlight\nlanes and curbs."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Neural Network Activations","class":"w-100 mt-3 mb-5","src":"/img/maeve-activations.jpg"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"the-steering-mechanism"},"children":[{"type":"text","value":"The Steering Mechanism"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After I finalised the model by testing it on the data collected in the\nprevious step, the next (and probably the most challenging) step was to design and implement the\nexecution unit that would take care of actually controlling the car."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Building on my previous success with gears and Arduino, my initial idea was to turn the wheel\nusing a single DC/Stepper motor connected to the board via an H-Bridge IC. I dismantled the rear\nwiper to get the DC motor, but it wasn't strong enough to turn the steering wheel reliably, even\nwith a high gear ratio."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Two steering unit prototypes","class":"w-100 mt-3 mb-5","src":"/img/maeve-motors.jpg"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After testing a few other motors I had lying around, which gave me a better idea of what I neede, I\nbought a way more powerful one (32Amp, 380W), mounted it to my setup, connected it to the board, and... fried\nthe 600mAmp H-Bridge straight away :) "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nWell, I'm mainly a software guy, so I apologize to all\nof you who are more experienced with electronics. Using an H-Bridge turned out to be an issue, since\none that would be strong enough for the circuit would be very expensive; the same goes for the cooling\nmechanism that would have to be used to keep a smaller H-Bridge alive."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Thus, just like earlier with the steering angle sensor, I overcame this obstacle by constructing my\nown \"H-Bridge\" using two relays, therefore physically separating the controller Arduino circuit and\nthe power-hungry DC motor connected to the car battery. After that, I spent another few hours fixing\nbugs, testing the setup on the dataset again, and driving in an empty parking lot."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Circuit diagram using relays","class":"w-100 mt-3 mb-5","src":"/img/maeve-relays-diagram.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"final-tests-and-results"},"children":[{"type":"text","value":"Final Tests and Results"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The first real tests failed horribly. The car started drifting away a few\nminutes into the driving, or it would make a strange, spontaneous decision, usually to make up for an\naccumulating error somewhere in the system. My favourite one was a test during bad weather\nconditions, when  the car decided it wanted to go for a quick swim in the lake nearby. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"A lot"}]},{"type":"text","value":" of hours and sleepless nights went into fixing bugs, implementing mechanisms to keep track\nof the errors and potentially overriding the autonomous system, further analysis of the model, and\nmore. After all that, I finally ended up with a system that produced impressive results and could generalise well in most of the scenarios, where the decisions do not rely on other aspects, such\nas recognition, detection, or navigation. Despite the somewhat simple design of the whole pipeline,\neverything that could go wrong did go wrong. There were so many challenges along the way, such as\nkeeping the motor stable, dealing with the precision of the steering angle to avoid the wheel\nendlessly oscillating between two values, tuning the sequence frequency, ..., that it is hard to\nbelieve this whole thing actually worked in the end. But it did."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","class":"w-50 mt-3 mb-5 pe-2","src":"https://media.giphy.com/media/HUBSzphkTC2HXJf80k/giphy.gif"},"children":[]},{"type":"element","tag":"img","props":{"alt":"","class":"w-50 mt-3 mb-5 ps-2","src":"https://media.giphy.com/media/xEgdH1FvRfpLub40tv/giphy-downsized-large.gif"},"children":[]}]},{"type":"element","tag":"h1","props":{"id":"conclusion"},"children":[{"type":"text","value":"Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This article described my experience of working on an advanced project as a beginner in both the software, and the hardware part.\nThe process of building an end-to-end pipeline for data collection, processing, implementing a\nneural network for autonomous steering, and making all the major hardware components from scratch\nwas definitely the most ambitious and valuable project I've ever built in terms of learning and\nsolidifying my knowledge. Looking back at the decisions made along the way, there's a lot of things I would\ndo differently today - but after all, that's what learning and progressing is all about. This project opened the world of self-driving cars, Deep Learning, and Computer Vision to me, and I hope to continue in that direction in the future."}]}]},"id":1,"author":"mateo","created_at":"2022-11-07T00:00:00.000Z","status":"draft","summary":"In the summer of 2021, I developed an autopilot software from scratch and implemented it in a real car. After publishing a demo and receiving many questions about the project, I decided to share the story behind the development process.","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After my second year of university in the summer of 2022, I decided to work on one of the most advanced\nprojects up to that time - developing an autopilot software from scratch and implementing it in a\nreal car. After making some of the main parts of my "},{"type":"element","tag":"a","props":{"href":"https://github.com/mateomd-dev/maeve-autopilot","rel":["nofollow"]},"children":[{"type":"text","value":"code"}]},{"type":"text","value":" public and publishing a "},{"type":"element","tag":"a","props":{"href":"https://youtu.be/h1Wg7Cn1D-E","rel":["nofollow"]},"children":[{"type":"text","value":"demo video"}]},{"type":"text","value":", I\nreceived many questions about the project. Therefore, I decided to share the story behind the\ndevelopment process."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I have always been fascinated by anything related to AI and Machine\nLearning. The idea of computers being able to learn and a complete paradigm shift in\nsoftware development, was incredibly inspiring to me. However, I could not wrap my head around it\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"at all"}]},{"type":"text","value":". Around February 2021, I started with arguably the most popular Coursera courses on the\nrelated topics — "},{"type":"element","tag":"a","props":{"href":"https://www.coursera.org/learn/machine-learning?utm_source=gg&utm_medium=sem&utm_campaign=07-StanfordML-ROW&utm_content=07-StanfordML-ROW&campaignid=2070742271&adgroupid=80109820241&device=c&keyword=machine%20learning%20mooc&matchtype=b&network=g&devicemodel=&adpostion=&creativeid=516962315003&hide_mobile_promo&gclid=CjwKCAiAksyNBhAPEiwAlDBeLHvf3K9Jfjs77yy7pFjfqGtLrzN0UMYYtcw3WhhsBxfEMC1IsaQuahoCqmEQAvD_BwE","rel":["nofollow"]},"children":[{"type":"text","value":"Machine\nLearning"}]},{"type":"text","value":",\nthe "},{"type":"element","tag":"a","props":{"href":"https://www.coursera.org/specializations/deep-learning?utm_source=gg&utm_medium=sem&utm_campaign=17-DeepLearning-ROW&utm_content=17-DeepLearning-ROW&campaignid=6465471773&adgroupid=77656689495&device=c&keyword=coursera%20deep%20learning%20specialization&matchtype=b&network=g&devicemodel=&adpostion=&creativeid=506750650449&hide_mobile_promo&gclid=CjwKCAiAksyNBhAPEiwAlDBeLPUYNmgNJuRtZNZUMIzj0njAzstXWVMLouSp1283hz5N_FCnUUr4kRoCGmUQAvD_BwE","rel":["nofollow"]},"children":[{"type":"text","value":"Deep Learning\nSpecialization"}]},{"type":"text","value":"\nand a part of the "},{"type":"element","tag":"a","props":{"href":"https://www.coursera.org/professional-certificates/tensorflow-in-practice","rel":["nofollow"]},"children":[{"type":"text","value":"TensorFlow Professional\nCertificate"}]},{"type":"text","value":". "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nI'm a huge proponent of hands-on learning, so I wanted to pick a project in a domain of interest I\ncould apply my knowledge. As a big fan of Tesla, I was drawn into the world of Autonomous Vehicles\nand Computer Vision right from the start - however, I wanted to go beyond just implementing a neural\nnetwork in e.g., a GTA car, so I took this idea to the next level."}]},{"type":"element","tag":"h1","props":{"id":"development-process"},"children":[{"type":"text","value":"Development Process"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After preliminary research, I \"settled\" for an autonomous steering\nmechanism due to time and budget constraints. It became apparent very quickly that even steering\nalone is a very challenging task. I started with the arguably more traditional approach of explicit decomposition of the problem by looking\ninto various algorithms for tasks such as lane detection and path planning. However, as this project was meant to\ndeepen my still-somewhat-shallow knowledge of Deep Learning, I was inclining more towards end-to-end\napproaches using neural networks. Soon, I came across an "},{"type":"element","tag":"a","props":{"href":"https://images.nvidia.com/content/tegra/automotive/images/2016/solutions/pdf/end-to-end-dl-using-px.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"NVIDIA paper"}]},{"type":"text","value":" from 2016, which discusses an implementation of a CNN that maps raw pixels from the video input to the steering\ncommands with surprisingly good results. There are also quite a few implementations available, which inspired me to create my own. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nThe high-level overview of the system is quite straightforward:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Mount a camera system to the front of the car"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Get the steering angle value at any given time"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Pair these two up and pass them through the neural network"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Build a system to execute a steering command on the steering wheel"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Adapt the system to a real-time execution, i.e., take an image of the road ahead, predict the\nsteering angle and execute it on the steering unit"}]}]},{"type":"element","tag":"h2","props":{"id":"choosing-the-car"},"children":[{"type":"text","value":"Choosing the Car"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Given the highly experimental and potentially destructive\nnature of this project, I bought the cheapest car I could find - concretely, the first model of\nSkoda Fabia. At this stage, I did not have a detailed plan for the implementation, so my only\nrequirement for the car was power steering, which made it possible to build the steering mechanism\nwithout extensive and costly adjustments to the steering column."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Naturally, the first and most important thing I did was to print a Tesla logo and slap it on the\nfront of the car. One time, I almost drove away with the wrong car..."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"test alt","class":"w-100 mt-3 mb-5","src":"/img/maeve-two-cars.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"collecting-data-on-a-budget"},"children":[{"type":"text","value":"Collecting Data on a Budget"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To stick to the \"end-to-end\" aspect of this project, I wanted to\nproduce my own dataset. After experimenting with a bunch of web cameras, I mounted an old iPhone 6S\nbehind the front window and used that instead for the video input. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nMeasuring the steering angle was a bigger challenge. Modern cars typically have either the CAN bus\nthat can be tapped into to get the precise steering angle at any given time, or a separate\nsteering angle sensor built directly inside the steering wheel. My car had neither, so I had to\nbuild my own sensor from scratch."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The main idea behind my design was to use the dynamically changing resistance caused by the steering\nand map it to the steering angle value. The first issue I faced was that the steering wheel\nturns more than 360 degrees, so I needed to account for these \"extra turns.\" My initial solution was\nto use a coil around the steering column, and a brush mounted to the column that would be sliding\nacross the coil, changing the resistance of the wire. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nSimpler (and, for most people, more obvious...) solution I ended up with was based on gears and a\npotentiometer: I calculated the gear ratios to map the steering angle values to the 360° range of a\npotentiometer mounted underneath the steering column, printed the gears, and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"voilà"}]},{"type":"text","value":":"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Steering Angle Sensor","class":"w-100 mt-3 mb-5","src":"/img/maeve-gears.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The potentiometer is wired up to an Arduino board, which then goes to the laptop running the code\nfor reading and matching the steering angle with the video input from the iPhone. While the script\nitself wasn't too complex, the difficult aspect of this setup was synchronizing the serial\ncommunication between the Arduino and the laptop due to the somewhat strict latency requirements of\nthe driving task. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nAfter that, long hours of driving around my town with Lex Fridman's podcasts in the background became\nmy go-to leisure activity."}]},{"type":"element","tag":"h3","props":{"id":"data-pre-processing"},"children":[{"type":"text","value":"Data Pre-Processing"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I experimented with several techniques during the training process of\ndifferent models, but only some produced significant results. The images from the video\ninput are resized to 100x100 and cropped to remove unnecessary features that confused the network,\nespecially during bad lighting conditions (mainly the sky getting overexposed). All images are\nconverted to a single-channel colour. Apart from these methods, I tried applying low values of\nGaussian blur and other filters - this made a small difference in some situations, but I was\nnot able to fully analyse the correlation."}]},{"type":"element","tag":"h2","props":{"id":"the-neural-network-architecture"},"children":[{"type":"text","value":"The Neural Network Architecture"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With a decent dataset, it was time to design\nand train the neural network. As I have mentioned, the initial architecture was based on the NVIDIA\npaper, however, I have experimented with many models and adjustments, especially in the demo, where\nthe overall system was very different."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The main architecture described in the paper, which is also part of the public repository, is the\nfollowing:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A Normalization Layer"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Six Convolution Layers (with ReLU activations), each followed by a Max-Pooling Layer"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A Flatten Layer"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Four Fully-Connected Layers, followed by one neuron in the last layer for the angle prediction"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Neural Network Architecture Diagram","class":"w-100 mt-3 mb-5","src":"/img/maeve-neural-net.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The network minimizes the MSE between the output of the network and the actual\nsteering angle. I wrote the model in TensorFlow, and for most parts, I was using my old laptop to\ntrain it (yes, it took ages to iterate). I used the Adam optimizer and Dropout during the training to obtain better results on\nother datasets. This model was sufficient for a slow drive on the testing dataset, failing only on complex or\nnon-repeating scenarios. As expected, the network's activations mainly highlight\nlanes and curbs."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Neural Network Activations","class":"w-100 mt-3 mb-5","src":"/img/maeve-activations.jpg"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"the-steering-mechanism"},"children":[{"type":"text","value":"The Steering Mechanism"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After I finalised the model by testing it on the data collected in the\nprevious step, the next (and probably the most challenging) step was to design and implement the\nexecution unit that would take care of actually controlling the car."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Building on my previous success with gears and Arduino, my initial idea was to turn the wheel\nusing a single DC/Stepper motor connected to the board via an H-Bridge IC. I dismantled the rear\nwiper to get the DC motor, but it wasn't strong enough to turn the steering wheel reliably, even\nwith a high gear ratio."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Two steering unit prototypes","class":"w-100 mt-3 mb-5","src":"/img/maeve-motors.jpg"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After testing a few other motors I had lying around, which gave me a better idea of what I neede, I\nbought a way more powerful one (32Amp, 380W), mounted it to my setup, connected it to the board, and... fried\nthe 600mAmp H-Bridge straight away :) "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nWell, I'm mainly a software guy, so I apologize to all\nof you who are more experienced with electronics. Using an H-Bridge turned out to be an issue, since\none that would be strong enough for the circuit would be very expensive; the same goes for the cooling\nmechanism that would have to be used to keep a smaller H-Bridge alive."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Thus, just like earlier with the steering angle sensor, I overcame this obstacle by constructing my\nown \"H-Bridge\" using two relays, therefore physically separating the controller Arduino circuit and\nthe power-hungry DC motor connected to the car battery. After that, I spent another few hours fixing\nbugs, testing the setup on the dataset again, and driving in an empty parking lot."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Circuit diagram using relays","class":"w-100 mt-3 mb-5","src":"/img/maeve-relays-diagram.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"final-tests-and-results"},"children":[{"type":"text","value":"Final Tests and Results"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The first real tests failed horribly. The car started drifting away a few\nminutes into the driving, or it would make a strange, spontaneous decision, usually to make up for an\naccumulating error somewhere in the system. My favourite one was a test during bad weather\nconditions, when  the car decided it wanted to go for a quick swim in the lake nearby. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"A lot"}]},{"type":"text","value":" of hours and sleepless nights went into fixing bugs, implementing mechanisms to keep track\nof the errors and potentially overriding the autonomous system, further analysis of the model, and\nmore. After all that, I finally ended up with a system that produced impressive results and could generalise well in most of the scenarios, where the decisions do not rely on other aspects, such\nas recognition, detection, or navigation. Despite the somewhat simple design of the whole pipeline,\neverything that could go wrong did go wrong. There were so many challenges along the way, such as\nkeeping the motor stable, dealing with the precision of the steering angle to avoid the wheel\nendlessly oscillating between two values, tuning the sequence frequency, ..., that it is hard to\nbelieve this whole thing actually worked in the end. But it did."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","class":"w-50 mt-3 mb-5 pe-2","src":"https://media.giphy.com/media/HUBSzphkTC2HXJf80k/giphy.gif"},"children":[]},{"type":"element","tag":"img","props":{"alt":"","class":"w-50 mt-3 mb-5 ps-2","src":"https://media.giphy.com/media/xEgdH1FvRfpLub40tv/giphy-downsized-large.gif"},"children":[]}]},{"type":"element","tag":"h1","props":{"id":"conclusion"},"children":[{"type":"text","value":"Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This article described my experience of working on an advanced project as a beginner in both the software, and the hardware part.\nThe process of building an end-to-end pipeline for data collection, processing, implementing a\nneural network for autonomous steering, and making all the major hardware components from scratch\nwas definitely the most ambitious and valuable project I've ever built in terms of learning and\nsolidifying my knowledge. Looking back at the decisions made along the way, there's a lot of things I would\ndo differently today - but after all, that's what learning and progressing is all about. This project opened the world of self-driving cars, Deep Learning, and Computer Vision to me, and I hope to continue in that direction in the future."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"choosing-the-car","depth":2,"text":"Choosing the Car"},{"id":"collecting-data-on-a-budget","depth":2,"text":"Collecting Data on a Budget","children":[{"id":"data-pre-processing","depth":3,"text":"Data Pre-Processing"}]},{"id":"the-neural-network-architecture","depth":2,"text":"The Neural Network Architecture"},{"id":"the-steering-mechanism","depth":2,"text":"The Steering Mechanism"},{"id":"final-tests-and-results","depth":2,"text":"Final Tests and Results"}]}},"_type":"markdown","_id":"content:articles:how-i-built-a-real-self-driving-car-from-scratch:index.md","_source":"content","_file":"articles/how-i-built-a-real-self-driving-car-from-scratch/index.md","_extension":"md"},{"_path":"/projects/3d-voxel-engine","_dir":"projects","_draft":false,"_partial":false,"_locale":"en","_empty":true,"title":"3D/Voxel Engine","description":"3D engine written from scratch in Java with a built-in OBJ reader, marching cubes algorithm, several lighting models, arc-ball 3D manipulation, ...","excerpt":{"type":"root","children":[]},"id":4,"link":"","img":"/img/projects/thumbnails/3d-voxel-engine.png","body":{"type":"root","children":[],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:projects:3d-voxel-engine.md","_source":"content","_file":"projects/3d-voxel-engine.md","_extension":"md"},{"_path":"/projects/effectivenes-of-skip-connections-in-object-recognition","_dir":"projects","_draft":false,"_partial":false,"_locale":"en","_empty":true,"title":"Effectiveness of Skip-Connections in Object Recognition","description":"Paper exploring the effectivenss of several network architectures with 1. no skip-connections, 2. additive skip-connections, and 3. concatenated skip-connections. The models used a similar number of parameters and were tested on the CIFAR-100 dataset.","excerpt":{"type":"root","children":[]},"id":5,"link":"","img":"/img/projects/thumbnails/effectiveness-of-skip-connections-in-object-recognition.png","body":{"type":"root","children":[],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:projects:effectivenes-of-skip-connections-in-object-recognition.md","_source":"content","_file":"projects/effectivenes-of-skip-connections-in-object-recognition.md","_extension":"md"},{"_path":"/projects/machine-learning-visualizer","_dir":"projects","_draft":false,"_partial":false,"_locale":"en","_empty":true,"title":"Machine Learning Visualizer","description":"Web application for visualizing the computation process of various algorithms from machine learning and optimization. This project also servers as a learning tool, as it is based on the syllabus of the ML module at Swansea University.","excerpt":{"type":"root","children":[]},"id":3,"link":"","img":"/img/projects/thumbnails/machine-learning-visualizer.png","body":{"type":"root","children":[],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:projects:machine-learning-visualizer.md","_source":"content","_file":"projects/machine-learning-visualizer.md","_extension":"md"},{"_path":"/projects/maeve-self-driving-car","_dir":"projects","_draft":false,"_partial":false,"_locale":"en","_empty":true,"title":"MAEVE - A Real Self-Driving Car","description":"Implementation of a fully autonomous steering mechanism built in a real-size car using a deep neural network. Both software and hardware components were created from scratch, including e.g. a steering angle sensor","excerpt":{"type":"root","children":[]},"id":1,"link":"","img":"/img/projects/thumbnails/maeve.png","body":{"type":"root","children":[],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:projects:maeve-self-driving-car.md","_source":"content","_file":"projects/maeve-self-driving-car.md","_extension":"md"},{"_path":"/projects/vision-pipeline-for-self-driving-cars","_dir":"projects","_draft":false,"_partial":false,"_locale":"en","_empty":true,"title":"Vision Pipeline for Self-Driving Cars","description":"Vision-based pipeline for 3D reconstruction from stereo input. Components included a SLAM module and several task-specific neural networks for e.g. depth estimation and semantic segmentation. This project was a part of my dissertation and is currently being extended to an open-source framework.","excerpt":{"type":"root","children":[]},"id":2,"link":"","img":"/img/projects/thumbnails/vision-pipeline-for-self-driving-cars.png","body":{"type":"root","children":[],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:projects:vision-pipeline-for-self-driving-cars.md","_source":"content","_file":"projects/vision-pipeline-for-self-driving-cars.md","_extension":"md"}],"navigation":[{"title":"Articles","_path":"/articles","children":[{"title":"How I Built a Real Self-Driving Car from Scratch","_path":"/articles/how-i-built-a-real-self-driving-car-from-scratch","children":[{"title":"How I Built a Real Self-Driving Car from Scratch","_path":"/articles/how-i-built-a-real-self-driving-car-from-scratch"}]}]},{"title":"Projects","_path":"/projects","children":[{"title":"3D/Voxel Engine","_path":"/projects/3d-voxel-engine"},{"title":"Effectiveness of Skip-Connections in Object Recognition","_path":"/projects/effectivenes-of-skip-connections-in-object-recognition"},{"title":"Machine Learning Visualizer","_path":"/projects/machine-learning-visualizer"},{"title":"MAEVE - A Real Self-Driving Car","_path":"/projects/maeve-self-driving-car"},{"title":"Vision Pipeline for Self-Driving Cars","_path":"/projects/vision-pipeline-for-self-driving-cars"}]}]}